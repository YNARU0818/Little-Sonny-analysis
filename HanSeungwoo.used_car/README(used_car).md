# ğŸš— Used Car Price Prediction

> ì¤‘ê³ ì°¨ì˜ ì œì›Â·ìƒíƒœ ì •ë³´ë¥¼ í™œìš©í•´ **ì°¨ëŸ‰ ê°€ê²©(`price`)ì„ ì˜ˆì¸¡**í•˜ëŠ” íšŒê·€(Regression) í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.  
> ë³¸ ë ˆí¬ì§€í† ë¦¬ëŠ” `used_car.ipynb`ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ **ë°ì´í„° ì´í•´ â†’ EDA ì¸ì‚¬ì´íŠ¸ â†’ Feature Engineering â†’ ëª¨ë¸ë§(LightGBM/CatBoost) â†’ êµì°¨ê²€ì¦(CV) â†’ ì œì¶œíŒŒì¼ ìƒì„±** íë¦„ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.

---

## 0. ë°œí‘œ íë¦„(Agenda)

1. **ë¬¸ì œ ì •ì˜ & í‰ê°€ ì§€í‘œ**
2. **ë°ì´í„°ì…‹ ì´í•´(ì»¬ëŸ¼/ê²°ì¸¡/ë¶„í¬)**
3. **EDA í•µì‹¬ ì¸ì‚¬ì´íŠ¸**
4. **Feature Engineering ì„¤ê³„ ì˜ë„**
5. **ëª¨ë¸ë§ ì „ëµ(Leak-free CV)**
6. **ê²°ê³¼(ì„±ëŠ¥) & í•´ì„**


---

## 1. Problem Statement

- ëª©í‘œ: `train.csv`ì˜ í•™ìŠµ ë°ì´í„°ë¥¼ ì´ìš©í•´ `test.csv`ì˜ **`price`ë¥¼ ì˜ˆì¸¡**
- ë¬¸ì œ ìœ í˜•: **íšŒê·€(Regression)**
- íƒ€ê¹ƒ ë¶„í¬: ê°€ê²©ì€ ì¼ë°˜ì ìœ¼ë¡œ **long-tail(ê¸´ ê¼¬ë¦¬)** ë¶„í¬ë¥¼ ê°€ì§€ë¯€ë¡œ, ë…¸íŠ¸ë¶ì—ì„œëŠ” í•™ìŠµ ì•ˆì •í™”ë¥¼ ìœ„í•´ `log1p(price)`ë¡œ ë³€í™˜í•´ í•™ìŠµí•©ë‹ˆë‹¤.

### Evaluation Metric (ë…¸íŠ¸ë¶ ê¸°ì¤€)
- **RMSE on `log1p(price)`**
- KFold 5-split (seed=42)ë¡œ í‰ê·  ì„±ëŠ¥ì„ ì¸¡ì •í•©ë‹ˆë‹¤.

---

## 2. Dataset Overview

ë…¸íŠ¸ë¶ ìƒë‹¨ì˜ ë°ì´í„° ì„¤ëª… ì…€ì„ ê¸°ë°˜ìœ¼ë¡œ ìš”ì•½í–ˆìŠµë‹ˆë‹¤.

- ê° row = **ì°¨ëŸ‰ 1ëŒ€**
- ê·œëª¨: **188,533 rows / 13 features (+ target price)**

### Columns

| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|---|---|---|
| `id` | int | ì°¨ëŸ‰ ê³ ìœ  ì‹ë³„ì |
| `brand` | cat | ì œì¡°ì‚¬ |
| `model` | cat | ëª¨ë¸ëª… |
| `model_year` | num | ì—°ì‹(ì¶œê³  ì—°ë„) |
| `milage` | num | ëˆ„ì  ì£¼í–‰ê±°ë¦¬ |
| `fuel_type` | cat | ì—°ë£Œ ìœ í˜• |
| `engine` | cat/text | ì—”ì§„ ì‚¬ì–‘ ë¬¸ìì—´(HP, ë°°ê¸°ëŸ‰, ì‹¤ë¦°ë” ë“± í¬í•¨) |
| `transmission` | cat | ë³€ì†ê¸° |
| `ext_col` | cat | ì™¸ì¥ ìƒ‰ìƒ |
| `int_col` | cat | ë‚´ì¥ ìƒ‰ìƒ |
| `accident` | cat | ì‚¬ê³ /ì†ìƒ ì´ë ¥ |
| `clean_title` | cat | íƒ€ì´í‹€(ì†Œìœ ê¶Œ) ìƒíƒœ |
| `price` | num | (train only) íƒ€ê¹ƒ ê°€ê²© |

---

## 3. EDA í•µì‹¬ ìš”ì•½

### 3.1 ê²°ì¸¡ì¹˜(Missing Values)

ë…¸íŠ¸ë¶ ì¶œë ¥ ê¸°ì¤€ ê²°ì¸¡ ê°œìˆ˜:

- `fuel_type`: 5,083
- `accident`: 2,452
- `clean_title`: 21,419  â† **ê°€ì¥ í¼**

> íŠ¹íˆ `clean_title` ê²°ì¸¡ ë¹„ì¤‘ì´ ê½¤ ì»¤ì„œ, â€œì •ë³´ ë¯¸ì œê³µâ€ ìì²´ê°€ ì‹ í˜¸ì¼ ìˆ˜ ìˆë‹¤ê³  ë³´ê³  **`MISSING` ì¹´í…Œê³ ë¦¬ë¡œ ë³´ì¡´**í–ˆìŠµë‹ˆë‹¤.

---

### 3.2 ìˆ˜ì¹˜í˜• ë¶„í¬(êµ¬ê°„ë³„ ë¹„ìœ¨)

#### `model_year` (ì—°ì‹)
ë…¸íŠ¸ë¶ì˜ binning ê²°ê³¼(ëŒ€ëµ ê· ë“± ë¶„í• ):

- 2018~2020 êµ¬ê°„ì´ **16.58%**ë¡œ ê°€ì¥ ë†’ê³ ,
- 2014~2016ì´ **13.31%**,
- 2022~2024ëŠ” **4.74%**ë¡œ ìƒëŒ€ì ìœ¼ë¡œ ì ìŠµë‹ˆë‹¤.

#### `milage` (ì£¼í–‰ê±°ë¦¬)
- ì „ë°˜ì ìœ¼ë¡œ êµ¬ê°„ë³„ ë¹„ì¤‘ì´ **ì•½ 10% ë‚´ì™¸ë¡œ ê³ ë¥´ê²Œ ë¶„í¬**í•˜ë„ë¡ binning ë˜ì–´ ìˆìœ¼ë©°,
- ê³ ì£¼í–‰(ìµœìƒìœ„ êµ¬ê°„ 136,731~405,000)ë„ **ì•½ 9.98%**ë¡œ ì¡´ì¬í•©ë‹ˆë‹¤.

> ê²°ë¡ : íŠ¹ì • êµ¬ê°„ì— ì‹¬í•˜ê²Œ ì ë¦¬ê¸°ë³´ë‹¤ëŠ”, ì—°ì‹/ì£¼í–‰ê±°ë¦¬ ëª¨ë‘ ë‹¤ì–‘í•œ ë²”ìœ„ë¥¼ ì»¤ë²„í•©ë‹ˆë‹¤.

---

### 3.3 ë²”ì£¼í˜• ë¶„í¬(Top ë¸Œëœë“œ)

`brand` ë¶„í¬ ìƒìœ„(ë…¸íŠ¸ë¶ ì¶œë ¥ ê¸°ì¤€):

1. Ford (12.25%)
2. Mercedes-Benz (10.17%)
3. BMW (9.03%)
4. Chevrolet (8.66%)
5. Audi (5.77%)
6. Porsche (5.63%)
7. Land (5.05%)  â† í‘œê¸°ê°€ â€œLandâ€ë¡œ ë“¤ì–´ì˜¨ ì¼€ì´ìŠ¤(ì •ê·œí™” ì—¬ì§€)
8. Toyota (4.69%)
9. Lexus (4.58%)
10. Jeep (3.43%)

> ê²°ë¡ : ìƒìœ„ ë¸Œëœë“œ ì§‘ì¤‘ì´ ìˆì§€ë§Œ, ì „ì²´ì ìœ¼ë¡œëŠ” ë‹¤ìˆ˜ ë¸Œëœë“œê°€ ì„ì¸ **ë¡±í…Œì¼ ì¹´í…Œê³ ë¦¬ êµ¬ì¡°**ì…ë‹ˆë‹¤.  
> ë”°ë¼ì„œ CatBoost ë˜ëŠ” OneHot(min_frequency) ê°™ì€ ì „ëµì´ ìœ íš¨í•©ë‹ˆë‹¤.

---

### 3.4 â€œì„¤ëª… ì•ˆ ë˜ëŠ” ì €ê°€â€ ë£° ê¸°ë°˜ ì ê²€
ë…¸íŠ¸ë¶ì—ì„œëŠ” â€œìµœê·¼ ì—°ì‹ì¸ë° ê·¹ë‹¨ì ìœ¼ë¡œ ì €ë ´í•œ priceâ€ ì¡°ê±´ìœ¼ë¡œ ì˜ì‹¬ ìƒ˜í”Œì„ íƒìƒ‰í–ˆì§€ë§Œ,
- ê²°ê³¼: **suspicious rows = 0**

> ì¦‰, ë‹¨ìˆœ ê·œì¹™ìœ¼ë¡œ ì¡íˆëŠ” ë¹„ì •ìƒ ì €ê°€ ìƒ˜í”Œì€ ê±°ì˜ ì—†ì—ˆê³ ,  
> ì˜¤íˆë ¤ ê³ ê°€/í¬ê·€ ëª¨ë¸ ë“±ì€ ë³„ë„ ì „ëµ(í´ë¦¬í•‘/ê°€ì¤‘ì¹˜)ë¡œ ë‹¤ë£¨ëŠ” í¸ì´ í•©ë¦¬ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 4. Feature Engineering (ì„¤ê³„ ì˜ë„ + êµ¬í˜„)

### 4.1 ì°¨ëŸ‰ ë‚˜ì´ & ì£¼í–‰ ê°•ë„
- `age = CURRENT_YEAR - model_year`
  - ë°ì´í„° ë‚´ ê°€ì¥ ìµœì‹  ì—°ë„ë¥¼ ê¸°ì¤€ìœ¼ë¡œ age ì •ì˜
  - ìŒìˆ˜ ë°©ì§€(`clip(lower=0)`)

- `log_milage = log1p(milage)`
  - ì£¼í–‰ê±°ë¦¬ë„ long-tail í˜•íƒœ â†’ ë¡œê·¸ ë³€í™˜ìœ¼ë¡œ ì•ˆì •í™”

- `milage_per_year = milage / (age + 1)`
  - ê°™ì€ ì£¼í–‰ê±°ë¦¬ë¼ë„ ì—°ì‹ì— ë”°ë¼ ì˜ë¯¸ê°€ ë‹¬ë¼ì§€ë¯€ë¡œ â€œì—°ê°„ ì£¼í–‰ ê°•ë„â€ë¥¼ ë°˜ì˜

- `log_milage_per_year = log1p(milage_per_year)`

---

### 4.2 ì—”ì§„ ë¬¸ìì—´ íŒŒì‹±(engine parsing)
`engine` í…ìŠ¤íŠ¸ì—ì„œ ì •ê·œì‹ì„ ì´ìš©í•´ ë‹¤ìŒì„ ì¶”ì¶œ:

- `engine_hp`: `(\d+\.?\d*)HP`
- `engine_liter`: `(\d+\.?\d*)L`
- `engine_cyl`: `(\d+)\s*Cylinder`

ê·¸ë¦¬ê³  íŒŒìƒ:

- `hp_per_liter = engine_hp / engine_liter`
- `hp_per_cyl = engine_hp / engine_cyl`

> ì˜ë„: ì—”ì§„ì€ ê°€ê²©ì„ ê°•í•˜ê²Œ ì„¤ëª…í•˜ëŠ” í•µì‹¬ featureì¸ë°, ì›ë³¸ì´ í…ìŠ¤íŠ¸ë¼ ê·¸ëŒ€ë¡œ ì“°ê¸° ì–´ë µìŠµë‹ˆë‹¤.  
> ìˆ˜ì¹˜í™”í•˜ë©´ â€œì¶œë ¥/ë°°ê¸°ëŸ‰/ì‹¤ë¦°ë”â€ì˜ êµ¬ì¡°ì  ì •ë³´ë¥¼ ëª¨ë¸ì´ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### 4.3 ë¸Œëœë“œ/ëª¨ë¸ í¬ì†Œë„(ë¹ˆë„ ê¸°ë°˜)
- `brand_freq = count(brand)`
- `model_freq = count(model)`

> ì˜ë„: íŠ¹ì • ë¸Œëœë“œ/ëª¨ë¸ì´ â€œìì£¼ ë“±ì¥í•˜ëŠ” ëŒ€ì¤‘ ëª¨ë¸ì¸ì§€ / í¬ê·€ ëª¨ë¸ì¸ì§€â€ê°€ ê°€ê²©ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### 4.4 ì‚¬ê³ /íƒ€ì´í‹€ ì´ì§„í™”
- `has_accident`:
  - accident == `"At least 1 accident or damage reported"` â†’ 1 else 0

- `is_clean_title`:
  - clean_title == `"Yes"` â†’ 1 else 0

> ì˜ë„: í…ìŠ¤íŠ¸ ì¹´í…Œê³ ë¦¬ë¥¼ â€œëª…í™•í•œ ë¦¬ìŠ¤í¬ ì‹ í˜¸â€ë¡œ ì••ì¶•í•´ ëª¨ë¸ì´ ì‰½ê²Œ í•™ìŠµí•˜ë„ë¡ í•©ë‹ˆë‹¤.

---

### 4.5 ìƒ‰ìƒ(Black ì—¬ë¶€) í”Œë˜ê·¸
- `is_black_ext`: ì™¸ì¥ìƒ‰ì— â€œblackâ€ í¬í•¨ ì—¬ë¶€
- `is_black_int`: ë‚´ì¥ìƒ‰ì— â€œblackâ€ í¬í•¨ ì—¬ë¶€

> ì˜ë„: íŠ¹ì • ì¸ê¸° ìƒ‰ìƒ/ì¸í…Œë¦¬ì–´ íŠ¸ë¦¼ì´ ê°€ê²©ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆë‹¤ëŠ” ê°€ì •.

---

## 5. FE ì ìš© ì „/í›„: íƒ€ê¹ƒê³¼ì˜ ì—°ê´€ë„ ë³€í™”

ë…¸íŠ¸ë¶ì—ì„œëŠ” FE ì „/í›„ë¡œ **`log(price)`ì™€ì˜ ì—°ê´€ë„(association)** ë¥¼ ë¹„êµí•©ë‹ˆë‹¤.

FE í›„ ìƒìœ„ ì—°ê´€ ë³€ìˆ˜(ë…¸íŠ¸ë¶ ì¶œë ¥ ì¼ë¶€):

- `milage`: -0.695
- `age`: -0.664
- `model_year`: +0.664
- `log_milage`: -0.635
- `engine_hp`: +0.544
- `has_accident`: -0.296
- `engine_cyl`: +0.218
- `is_clean_title`: -0.201
- `engine_liter`: +0.172

> í•´ì„: ì—°ì‹/ì£¼í–‰ê±°ë¦¬ ë¿ ì•„ë‹ˆë¼ **engine íŒŒìƒ ë³€ìˆ˜**ë“¤ì´ ìœ ì˜ë¯¸í•œ ì‹ í˜¸ë¡œ ë– ì˜¤ë¥´ë©°,  
> FEê°€ â€œê°€ê²©ì„ ì„¤ëª…í•˜ëŠ” êµ¬ì¡°ì  ì •ë³´â€ë¥¼ ì¶”ê°€í•´ ì¤€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 6. Preprocessing ì „ëµ

### 6.1 íƒ€ê¹ƒ ë³€í™˜
- `y = log1p(price)`
- ì˜ˆì¸¡ í›„ ì œì¶œ ì‹œ: `price_pred = expm1(pred_log)`

### 6.2 ê²°ì¸¡ì¹˜ ì²˜ë¦¬
- ë²”ì£¼í˜•ì€ `"MISSING"`ìœ¼ë¡œ í†µì¼í•´ â€œê²°ì¸¡ ìì²´ë¥¼ í•˜ë‚˜ì˜ ì¹´í…Œê³ ë¦¬â€ë¡œ ì·¨ê¸‰
- ìˆ˜ì¹˜í˜•ì€ inf/-infë¥¼ NaN ì²˜ë¦¬ í›„ imputer ì ìš©

---

## 7. Modeling

### 7.1 LightGBM (Leak-free CV)

**í•µì‹¬ í¬ì¸íŠ¸: ë°ì´í„° ëˆ„ìˆ˜ ë°©ì§€**
- foldë§ˆë‹¤ `fit_transform / transform`ì„ ë¶„ë¦¬í•´, ì¸ì½”ë”/ì„í“¨í„°ê°€ validation ì •ë³´ë¥¼ ë³´ì§€ ì•Šë„ë¡ êµ¬ì„±í•©ë‹ˆë‹¤.

LightGBM íŒŒë¼ë¯¸í„°(ë…¸íŠ¸ë¶ FINAL CV CELL ê¸°ì¤€):

- objective: regression
- metric: rmse
- boosting: gbdt
- learning_rate: 0.03
- num_leaves: 256
- min_data_in_leaf: 50
- feature_fraction: 0.8
- bagging_fraction: 0.8
- bagging_freq: 1
- lambda_l2: 1.0
- early_stopping_rounds: 300

âœ… ê²°ê³¼ (5-Fold CV, RMSE on log1p):
- Foldë³„ RMSE: 0.486 ~ 0.490
- **CV RMSE(log1p): 0.4875877**

---

### 7.2 CatBoost (categorical/text ì¹œí™”)

CatBoostëŠ” ë²”ì£¼í˜•ì„ ì§ì ‘ ë‹¤ë£¨ëŠ” ë° ê°•ì ì´ ìˆì–´,
- `cat_features`ë¥¼ ì§€ì •í•´ í•™ìŠµ
- ì¼ë¶€ ì‹¤í—˜ì—ì„œëŠ” `engine`ì„ text featureë¡œë„ ë‹¤ë£¨ëŠ” íë¦„ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

CatBoost íŒŒë¼ë¯¸í„°(ë…¸íŠ¸ë¶ CV ì…€ ê¸°ì¤€):

- loss_function: RMSE
- iterations: 5000
- learning_rate: 0.05
- depth: 8
- l2_leaf_reg: 3
- early_stopping_rounds: 200
- verbose: False

âœ… ê²°ê³¼ (5-Fold CV, RMSE on log1p):
- Fold1~5 RMSE: 0.4868 ~ 0.4894
- **CV mean: 0.4879865 (std: 0.0010641)**

---

## 8. Submission ìƒì„±(ì˜ˆì¸¡ íŒŒì¼)

ë…¸íŠ¸ë¶ì—ì„œëŠ” í•™ìŠµëœ ëª¨ë¸ë¡œ `test.csv`ë¥¼ ì˜ˆì¸¡ í›„,
`sample_submission.csv` í¬ë§·ì— ë§ì¶° `submission.csv`ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

- ì˜ˆì¸¡ì€ `log1p` ìŠ¤ì¼€ì¼ë¡œ ìˆ˜í–‰ â†’ ë§ˆì§€ë§‰ì— `expm1`ë¡œ ì›ë˜ ê°€ê²© ìŠ¤ì¼€ì¼ ë³µì›
- ì €ì¥ íŒŒì¼: `submission.csv`

> âœ… ë…¸íŠ¸ë¶ ì¶œë ¥: â€œsample_submission.csv í¬ë§·ìœ¼ë¡œ submission ìƒì„± / saved: submission.csvâ€

---
